I"[N<h1 id="build-a-lamp-stack">Build a LAMP Stack</h1>
<p><img src="/assets/LAMP.jpg" alt="LAMP STACK" /></p>

<h2 id="table-of-contents">Table of Contents</h2>
<ul>
  <li><a href="#build-a-lamp-stack">Build a LAMP Stack</a>
    <ul>
      <li><a href="#table-of-contents">Table of Contents</a></li>
      <li><a href="#project-description">Project Description</a></li>
      <li><a href="#requirements">Requirements</a></li>
      <li><a href="#setting-up-the-server-environment">Setting Up The Server Environment</a>
        <ul>
          <li><a href="#virtual-machine-specifications">Virtual Machine Specifications</a></li>
          <li><a href="#configuring-the-servers-operating-system">Configuring the server’s operating system</a>
            <ul>
              <li><a href="#setting-up-ufw">Setting up UFW</a></li>
              <li><a href="#setting-up-ssh">Setting up SSH</a></li>
            </ul>
          </li>
        </ul>
      </li>
      <li><a href="#install-the-software">Install The Software</a>
        <ul>
          <li><a href="#apache">Apache</a>
            <ul>
              <li><a href="#useful-systemctl-commands">Useful systemctl commands</a></li>
            </ul>
          </li>
          <li><a href="#mysql">MySQL</a></li>
          <li><a href="#php">PHP</a></li>
          <li><a href="#phpmyadmin">PHPMyAdmin</a></li>
        </ul>
      </li>
      <li><a href="#project-code">Project Code</a></li>
      <li><a href="#difficulties-encountered">Difficulties Encountered</a></li>
      <li><a href="#work-cited">Work Cited</a></li>
    </ul>
  </li>
</ul>

<h2 id="project-description">Project Description</h2>
<p>In this project, I am creating a Web application hosted on a Linux server for logging my blood sugar (glucose) levels. The application must meet the following requirements:</p>
<ul>
  <li>Must provide an input box for entering an integer value for the current glucose level.</li>
  <li>Every entry must be saved to a database including the time stamp</li>
  <li>Must provide a way to display a table of all the entries arranged by date and time</li>
</ul>

<h2 id="requirements">Requirements</h2>
<p>The project requires the use of a LAMP Stack (Linux, Apache, Mysql, and PHP). I am using the following specifications:</p>
<ul>
  <li>Linux Distribution: Ubuntu Server 20.04</li>
  <li>Web Server: Apache</li>
  <li>DBMS: MariaDB (from the standard software repositories)</li>
  <li>Php version: PHP 7</li>
</ul>

<h2 id="setting-up-the-server-environment">Setting Up The Server Environment</h2>
<h3 id="virtual-machine-specifications">Virtual Machine Specifications</h3>
<p>The virtual machine is built on HyperV in a Windows 10 Pro64 bit host. The host hardware specifications are:</p>

<p><img src="/assets/vmspecs.png" alt="vm specs" /></p>

<p>The Virtual machine specifications are:</p>
<ul>
  <li>RAM: 2GB</li>
  <li>CPU: 2 cores</li>
  <li>Network adapter: 1 NIC in Bridge configuration to make development easy</li>
</ul>

<h3 id="configuring-the-servers-operating-system">Configuring the server’s operating system</h3>
<p>After installing <a href="https://youtu.be/laQSC0KYWck">Ubuntu Server</a> in the virtual machine, there are some configurations that need to be done before installing a web server and a database.  It is essential to set up a firewall so that only connections to certain services are allowed. Additionally, SSH needs to be set up so that a remote connection to the server can be performed. For this project, I have enabled ssh to use keys for authentication instead of the default username and password functionality.</p>
<h4 id="setting-up-ufw">Setting up UFW</h4>
<p>Ubuntu uses ufw (uncomplicated firewall) as the default firewall configuration tool for iptables. Ufw can block services by port, network interface, and IP addresses. The following commands are used to set it up:</p>
<ul>
  <li>To check the firewall status:
<code class="language-plaintext highlighter-rouge">sudo ufw status</code></li>
  <li>To list all applications that have register their profiles with UFW:
<code class="language-plaintext highlighter-rouge">sudo ufw app list</code></li>
  <li>To enable/disable/reload the firewall
<code class="language-plaintext highlighter-rouge">sudo ufw enable|disable|reload</code></li>
  <li>To allow SSH connections
<code class="language-plaintext highlighter-rouge">sudo ufw allow openssh</code></li>
  <li>To block an IP address
<code class="language-plaintext highlighter-rouge">sudo ufw deny from 10.10.2.5</code></li>
  <li>To allow/deny connections from a given port
``sudo ufw allow|deny 21`</li>
  <li>To allow/deny incoming HTTP requests
<code class="language-plaintext highlighter-rouge">sudo ufw allow|deny http</code></li>
  <li>To allow/deny all incoming traffic from HTTP or https
<code class="language-plaintext highlighter-rouge">sudo ufw allow|deny proto tcp from any to any port 80,443</code></li>
</ul>

<p>For this project, It is necessary to make sure that the firewall is working and that at least for now ssh connections are permitted. To accomplish this use the following 1 liner: `
sudo ufw allow openssh; sudo ufw enable; sudo ufw status`</p>

<p><img src="/assets/firewallcheck.png" alt="Firewall check" /></p>

<h4 id="setting-up-ssh">Setting up SSH</h4>
<p>Before setting up SSH keys, it is important to make sure that a connection with only the username and password can be made. In Windows, you can use <a href="https://bit.ly/32UtZl4">Putty</a> which is a free SSH and Telnet client, or If your Windows 10 host computer is updated to the latest version, you should be able to use OpenSSH in Powershell or the <a href="https://bit.ly/39rB4L0">Windows terminal.</a> To connect to the virtual machine, all is needed is the IP address of the machine and making sure that the server has a network interface card in bridge mode. In Hyper-V, you need to <a href="https://rapurl.live/p8w">create a virtual switch</a> and then assign the virtual switch to the NIC of the VM. In the virtual switch management dialog box, the new switch needs to be set to External Network, and Allow management of the OS to share the network adapter needs to be checked.</p>

<p><img src="/assets/hperv-vswitch.png" alt="Hyper V Virtual Switch" /></p>

<p>To obtain the IP address of the server using any of the following commands:</p>
<ul>
  <li>The hostname command will display all the IP addresses assigned to the host. <code class="language-plaintext highlighter-rouge">hostname -I</code></li>
  <li>The ifconfig and ip commands are used for configuring network interfaces. Ifconfig is deprecated as it is part of the net-tools package. Ip is the command that replaces the ifconfig command. If the examples below do not work for you, use the ifconfig command or ip command without the pipes, and examine the output carefully.
    <ul>
      <li><code class="language-plaintext highlighter-rouge">ifconfig | grep “inet” | head -1</code></li>
      <li><code class="language-plaintext highlighter-rouge">ip addr | grep “inet” | head - 3 | tail -1</code></li>
    </ul>
  </li>
</ul>

<p>To connect to the Ubuntu Server, in your Windows Terminal/Powershell type:</p>

<p><code class="language-plaintext highlighter-rouge">ssh your-username-in-the-server@ip-of-your-server</code></p>

<p>You will be asked to provide the user’s password and after successfully entering it, you will be connected to the server from your host computer. Because connecting to the server will be a repetitive task, I have set up SSH keys so that I do not have to type a password to connect. To create an SSH key, type the following command on the machine that will be connecting to the server:</p>

<p><code class="language-plaintext highlighter-rouge">ssh-keygen.exe</code></p>

<p>The command will generate an ssh-key and it will store it in a dedicated directory. Once the 
key is generated, we need to copy it to the Ubuntu Server. Use this command to achieve this task:</p>

<p><code class="language-plaintext highlighter-rouge">scp C:\Users\[username]\.ssh\id_rsa.pub your-username-in-the-server@ip-of-your-server:/home/username</code></p>

<p>Once you have copied the SSH key, connect to the server one more time so that you can place the key in its appropriate directory. Use the following commands:</p>

<ol>
  <li><code class="language-plaintext highlighter-rouge">ssh your-username-in-the-server@ip-of-your-server</code></li>
  <li><code class="language-plaintext highlighter-rouge">cat id_rsa.pub &gt;&gt; .ssh/authorized_keys</code></li>
</ol>

<p><img src="/assets/sshcopyid.png" alt="SSH Setup 1" /></p>

<p><img src="/assets/sshcopyid2.png" alt="SSH Setup 2" /></p>

<p>Now you should be able to connect to the server without the need of a password.</p>

<h2 id="install-the-software">Install The Software</h2>
<h3 id="apache">Apache</h3>
<p>Apache HTTP Server is an Open Source and Free Software web server software available in Linux, Windows, macOS, Solaris, and BSD. To install Apache on Ubuntu use the following command:</p>

<p><code class="language-plaintext highlighter-rouge">sudo apt install apache2</code></p>

<p>Once Apache has been installed, it needs to be enabled and restarted. Enabling a service in a Linux System means that such service/daemon will run on startup. To enable and restart Apache use the following command:</p>

<p><code class="language-plaintext highlighter-rouge">sudo systemctl enable apache2 &amp;&amp; sudo systemctl restart apache2</code></p>

<p>In the command above the Systemctl program is used for managing Systemd which is Ubuntu’s init system and service manager.  After enabling and restarting the Apache webserver service, it is required to allow HTTP/HTTPS traffic to the webserver. Use the following command to allow these connections through the firewall:</p>

<p><code class="language-plaintext highlighter-rouge">sudo ufw allow in "Apache"</code></p>

<p>To check if your Apache Web server is running, open a web browser and type your server’s IP address in the URL bar. If your server is running, you should see the page below. If your server is not running, you can use the Systemctl useful commands and Apache log files to find the root cause of the problem. Keep in mind that the server must be in the same network as the client machine from where you attempted to visit the server’s IP.</p>

<p><img src="/assets/apacheworks.png" alt="Apache works" /></p>

<h4 id="useful-systemctl-commands">Useful systemctl commands</h4>
<ul>
  <li>To view active Systemd jobs:
<code class="language-plaintext highlighter-rouge">systemctl list-jobs</code></li>
  <li>To view the default  run level:
<code class="language-plaintext highlighter-rouge">systemctl get-default</code></li>
  <li>To stop a running service:
<code class="language-plaintext highlighter-rouge">systemctl stop  service-name-here</code></li>
  <li>To start a service:
<code class="language-plaintext highlighter-rouge">systemctl start  service-name-here</code></li>
  <li>To restart a running service:
<code class="language-plaintext highlighter-rouge">systemctl restart  service-name-here</code></li>
  <li>To reload any service config’s file:
<code class="language-plaintext highlighter-rouge">systemctl reload  service-name-here</code></li>
  <li>To see the status of a service:
<code class="language-plaintext highlighter-rouge">systemctl status  service-name-here</code></li>
  <li>To enable a service on startup:
<code class="language-plaintext highlighter-rouge">systemctl enable service-name-here</code></li>
  <li>To prevent a service from stating up at boot:
<code class="language-plaintext highlighter-rouge">systemctl disable  service-name-here</code></li>
</ul>

<p>Apache saves logs files in the directory <code class="language-plaintext highlighter-rouge">/var/log/apache2</code>. The apache2 directory contains 2 files: <code class="language-plaintext highlighter-rouge">access.log</code> and <code class="language-plaintext highlighter-rouge">error.log</code>. The access.log file stores information about requests coming into the web server. The error.log file stores information about errors the web server encountered when processing requests.  To review these log files, use the commands <code class="language-plaintext highlighter-rouge">cat</code>, <code class="language-plaintext highlighter-rouge">tac</code>, <code class="language-plaintext highlighter-rouge">head</code>, <code class="language-plaintext highlighter-rouge">tail</code>, and <code class="language-plaintext highlighter-rouge">grep</code>. You can find examples of these commands in my <a href="https://bit.ly/2CZZks0">website</a>.</p>

<p>Another useful tool when troubleshooting issues with logs is the program <code class="language-plaintext highlighter-rouge">Journalctl</code>. Journalctl is used for querying and displaying logs from journald, systemd’s logging service. Without any argument, journalctl returns the full contents of the journal, starting with the oldest entry collected. Journalctl is efficient in outputting logs in multiple formats, for example, the following command will show Apache logs formatted in JSON:
<code class="language-plaintext highlighter-rouge">journalctl -u apache2.service -r -o json-pretty</code></p>

<p><img src="/assets/journalctl.png" alt="Journaltcl example" /></p>

<h3 id="mysql">MySQL</h3>
<p>To install MySQL in Ubuntu use the following command: <code class="language-plaintext highlighter-rouge">sudo apt install mysql-server</code>. After installing mysql-server, it is vital to run mysql_secure_installation to remove some insecure default settings and lock down access to the database. 
<code class="language-plaintext highlighter-rouge">sudo mysql_secure_installation</code></p>

<p><img src="/assets/mysqlseqinstall.png" alt="mysql secure installation" /></p>

<h3 id="php">PHP</h3>
<p>PHP is an open-source general-purpose scripting language for the web. PHP was invented by Rasmus Lerdorf in 1994. In PHP, different from JavaScript, the code is executed on the web server and then the client receives the result of the execution in HTML.  To install PHP in Ubuntu Server run the following command:</p>

<p><code class="language-plaintext highlighter-rouge">sudo apt install php libapache2-mod-php php-mysql</code></p>

<p>To test if PHP has been installed and it is running correctly, we can build a simple PHP page that will show the information about your PHP installation. First, make a backup of your index.html page then create a file called index.php and in it, type <code class="language-plaintext highlighter-rouge">&lt;?php phpinfo(); ?&gt;</code>.</p>

<p><img src="/assets/php.png" alt="PHP Installed" /></p>

<h3 id="phpmyadmin">PHPMyAdmin</h3>
<p>Since PHP is a server-side programming language, it is useful when dealing with databases. However, managing databases via the command line can easily become a cumbersome chore. PHPMyAdmin is a web-based client that allows developers to manage databases with a simple to use interface.  You can use phpMyAdmin to perform most administration tasks, such as creating a database, running queries, and adding user accounts. Before installing PHPMyAdmin, log in to your database, and check the password validation policy. The PHPMyAdmin installer will ask you for a password that matches the validation rules. Here is an example of how it looks:</p>

<p><img src="/assets/phpmyadmininstalled.png" alt="phpmyadmin installed" /></p>

<p>To install PHPMyAdmin use the following command: <code class="language-plaintext highlighter-rouge">sudo apt install phpmyadmin php-mbstring</code></p>

<p>The PHPMyAdmin installer will ask you for several questions. Each prompt has a description of what is being asked therefore it is pivotal to read everything. Here are the questions and the answers I used:</p>

<ul>
  <li><strong>Web server to reconfigure automatically:</strong> Apache (make sure to hit the space bar to select)</li>
  <li><strong>Configure database for phpmyadmin with dbconfig-common?</strong> Yes</li>
  <li><strong>Connection method for MySQL database of phpmyadmin:</strong> Unix Socket</li>
  <li><strong>Authentication plugin for MySQL database:</strong> Default</li>
  <li><strong>MySQL database name for phpmyadmin:</strong> it640project</li>
  <li><strong>MySQL username for phpmyadmin:</strong> robert@localhost</li>
  <li><strong>Password:</strong> Project640!</li>
</ul>

<blockquote>
  <p><strong>Note:</strong> if you encounter the error: 1819 (HY000) do not disable the validate_password plugin, instead, ignore the error and after PHPMyAdmin finishes installing, log into the database and run the create user command with a password that meets the policy.
Here is an example:<code class="language-plaintext highlighter-rouge">CREATE USER 'robert'@'localhost' IDENTIFIED BY 'Project640!'; 
FLUSH PRIVILEGES;</code></p>
</blockquote>

<p>To test PHPMyAdmin, go to your web browser and type the username and password you created:</p>

<p><img src="/assets/phpmyadminloginpage.png" alt="phpmyadmin login page" /></p>

<h2 id="project-code">Project Code</h2>

<p>Once the system is configured and all the software is installed. I proceeded to write the base of the code. The first part is to write a basic HTML form where the user can enter the Glucose number and select the time and day. The HTML is then connected to a PHP script that sends the imputed data into the database. Once the data is in the database, the script runs another query to show all the values that have been entered so far. 
You can download a copy of the source code here: https://robertalberto.com/it640.tar</p>

<p><img src="/assets/htmlcode.png" alt="HTML Part" /></p>

<p><img src="/assets/css.png" alt="CSS Part" /></p>

<p><img src="/assets/phpcode.png" alt="PHP Part" /></p>

<p><img src="/assets/codedemonstration.png" alt="Code Demonstration" /></p>

<h2 id="difficulties-encountered">Difficulties Encountered</h2>

<p><strong>MySQL Validate Password Plugin Issue:</strong>
During the installation of PHPMyAdmin, I came across a problem with the password validation plugin used by MySQL. Regardless of the password chosen, the phpmyadmin installer kept rejecting it. Online I found several solutions that involved uninstalling the plugin, changing the password policy, and creating another user that matches the policy exactly. None of these were viable solutions in my case. I solved this problem by first purging the PHPMyAdmin packages and dependencies, then I logged in to MySQL and created a user. In the installer, I chose to not ignore the problem and then log in to MySQL again and change the password of the newly created user. This user was then given full access to the database and I was able to continue with the project.</p>

<p><strong>PHP Error 500 issue Server could not process request</strong>
While creating the PHP script I kept making syntax mistakes that were not obvious at the time. For instance, misspelling mysqli_connect, using double quotes in the _POST array and forgetting the $ at the beginning of the variable declaration. I decided to enable logging so that I can be aware of when I make these types of mistakes. This helped me out tremendously and I was able to get back on track quickly.</p>

<h2 id="work-cited">Work Cited</h2>
<p>DigitalOcean. “UFW Essentials: Common Firewall Rules and Commands.” DigitalOcean, DigitalOcean, 18 Sept. 2019, www.digitalocean.com/community/tutorials/ufw-essentials-common-firewall-rules-and-commands.</p>

<p>“Log Files.” Log Files - Apache HTTP Server Version 2.4, httpd.apache.org/docs/2.4/logs.html</p>

<p>“Systemd Cheat Sheet.” Linux Training Academy, www.linuxtrainingacademy.com/systemd-cheat-sheet/.</p>

<table>
  <tbody>
    <tr>
      <td>“Using Journalctl - The Ultimate Guide To Logging.” Log Analysis</td>
      <td>Log Monitoring by Loggly, 13 Aug. 2019, www.loggly.com/ultimate-guide/using-journalctl/.</td>
    </tr>
  </tbody>
</table>

<p>“What Is PHP?” Php, www.php.net/manual/en/intro-whatis.php.</p>
:ET